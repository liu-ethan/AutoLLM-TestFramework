{"uid":"3fd6ebb6055a5cf","name":"创建新用户成功","fullName":"test_runner.test_executor#test_api_case","historyId":"d72d8dcaf7f0aed21650c9f92eab5eef","time":{"start":1770172762148,"stop":1770172762228,"duration":80},"description":"\n    用例执行入口（Pytest 会为每条 JSON 用例生成一次调用）。\n\n    流程：\n    1) 从 case_data 解析请求信息\n    2) 发起 HTTP 请求\n    3) 调用 AIJudge 进行断言\n    ","descriptionHtml":"<pre><code>用例执行入口（Pytest 会为每条 JSON 用例生成一次调用）。\n\n流程：\n1) 从 case_data 解析请求信息\n2) 发起 HTTP 请求\n3) 调用 AIJudge 进行断言\n</code></pre>\n","status":"failed","statusMessage":"AssertionError: assert False\n +  where False = verify('成功，返回新用户信息。', '{\"timestamp\":\"2026-02-04T02:39:22.211+00:00\",\"status\":500,\"error\":\"Internal Server Error\",\"path\":\"/api/user/add\"}', assert_type='semantic_match', use_ai_assertion=False)\n +    where verify = <src.core.ai_judge.AIJudge object at 0x7bd07a1933a0>.verify","statusTrace":"case_data = {'assert_type': 'semantic_match', 'data': {'email': 'new_user@example.com', 'password': '123456', 'role': 'USER', 'username': 'new_user'}, 'expected': '成功，返回新用户信息。', 'headers': {'Authorization': 'Bearer {token}'}, ...}\n\n    def test_api_case(case_data: Dict[str, Any]) -> None:\n        \"\"\"\n        用例执行入口（Pytest 会为每条 JSON 用例生成一次调用）。\n    \n        流程：\n        1) 从 case_data 解析请求信息\n        2) 发起 HTTP 请求\n        3) 调用 AIJudge 进行断言\n        \"\"\"\n    \n        logger = get_logger(__name__)\n        settings = read_yaml(\"config/settings.yaml\")\n        exec_cfg = settings.get(\"execution\", {})\n    \n        # 0) 动态化 Allure 标注\n        module_name = case_data.get(\"module\")\n        story_name = case_data.get(\"story\")\n        case_title = case_data.get(\"title\") or case_data.get(\"name\")\n        if module_name:\n            allure.dynamic.feature(module_name)\n        if story_name:\n            allure.dynamic.story(story_name)\n        if case_title:\n            allure.dynamic.title(case_title)\n    \n        # 1) 解析用例字段\n        url = case_data.get(\"url\")\n        method = case_data.get(\"method\", \"GET\")\n        headers = case_data.get(\"headers\") or {}\n        params = case_data.get(\"params\") or {}\n        payload = case_data.get(\"data\") or {}\n    \n        if not url:\n            pytest.skip(\"Case missing URL\")\n    \n        # 2) 发起请求\n        logger.info(\"Executing case: %s %s\", method, url)\n        response = requests.request(\n            method=method,\n            url=url,\n            headers=headers,\n            params=params,\n            json=payload,\n            timeout=exec_cfg.get(\"request_timeout_seconds\", 30),\n            verify=exec_cfg.get(\"verify_ssl\", True),\n        )\n    \n        # 3) 断言配置（用例优先于全局配置）\n        assert_type = case_data.get(\"assert_type\", exec_cfg.get(\"default_assert_type\", \"semantic_match\"))\n        use_ai = case_data.get(\"use_ai_assertion\", exec_cfg.get(\"use_ai_assertion\", True))\n    \n        judge = AIJudge()\n        expected = case_data.get(\"expected\", \"\")\n        actual = response.text\n    \n        # 4) 执行断言\n>       assert judge.verify(expected, actual, assert_type=assert_type, use_ai_assertion=use_ai)\nE       assert False\nE        +  where False = verify('成功，返回新用户信息。', '{\"timestamp\":\"2026-02-04T02:39:22.211+00:00\",\"status\":500,\"error\":\"Internal Server Error\",\"path\":\"/api/user/add\"}', assert_type='semantic_match', use_ai_assertion=False)\nE        +    where verify = <src.core.ai_judge.AIJudge object at 0x7bd07a1933a0>.verify\n\ntest_runner/test_executor.py:70: AssertionError","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":4,"retriesStatusChange":false,"beforeStages":[],"testStage":{"description":"\n    用例执行入口（Pytest 会为每条 JSON 用例生成一次调用）。\n\n    流程：\n    1) 从 case_data 解析请求信息\n    2) 发起 HTTP 请求\n    3) 调用 AIJudge 进行断言\n    ","status":"failed","statusMessage":"AssertionError: assert False\n +  where False = verify('成功，返回新用户信息。', '{\"timestamp\":\"2026-02-04T02:39:22.211+00:00\",\"status\":500,\"error\":\"Internal Server Error\",\"path\":\"/api/user/add\"}', assert_type='semantic_match', use_ai_assertion=False)\n +    where verify = <src.core.ai_judge.AIJudge object at 0x7bd07a1933a0>.verify","statusTrace":"case_data = {'assert_type': 'semantic_match', 'data': {'email': 'new_user@example.com', 'password': '123456', 'role': 'USER', 'username': 'new_user'}, 'expected': '成功，返回新用户信息。', 'headers': {'Authorization': 'Bearer {token}'}, ...}\n\n    def test_api_case(case_data: Dict[str, Any]) -> None:\n        \"\"\"\n        用例执行入口（Pytest 会为每条 JSON 用例生成一次调用）。\n    \n        流程：\n        1) 从 case_data 解析请求信息\n        2) 发起 HTTP 请求\n        3) 调用 AIJudge 进行断言\n        \"\"\"\n    \n        logger = get_logger(__name__)\n        settings = read_yaml(\"config/settings.yaml\")\n        exec_cfg = settings.get(\"execution\", {})\n    \n        # 0) 动态化 Allure 标注\n        module_name = case_data.get(\"module\")\n        story_name = case_data.get(\"story\")\n        case_title = case_data.get(\"title\") or case_data.get(\"name\")\n        if module_name:\n            allure.dynamic.feature(module_name)\n        if story_name:\n            allure.dynamic.story(story_name)\n        if case_title:\n            allure.dynamic.title(case_title)\n    \n        # 1) 解析用例字段\n        url = case_data.get(\"url\")\n        method = case_data.get(\"method\", \"GET\")\n        headers = case_data.get(\"headers\") or {}\n        params = case_data.get(\"params\") or {}\n        payload = case_data.get(\"data\") or {}\n    \n        if not url:\n            pytest.skip(\"Case missing URL\")\n    \n        # 2) 发起请求\n        logger.info(\"Executing case: %s %s\", method, url)\n        response = requests.request(\n            method=method,\n            url=url,\n            headers=headers,\n            params=params,\n            json=payload,\n            timeout=exec_cfg.get(\"request_timeout_seconds\", 30),\n            verify=exec_cfg.get(\"verify_ssl\", True),\n        )\n    \n        # 3) 断言配置（用例优先于全局配置）\n        assert_type = case_data.get(\"assert_type\", exec_cfg.get(\"default_assert_type\", \"semantic_match\"))\n        use_ai = case_data.get(\"use_ai_assertion\", exec_cfg.get(\"use_ai_assertion\", True))\n    \n        judge = AIJudge()\n        expected = case_data.get(\"expected\", \"\")\n        actual = response.text\n    \n        # 4) 执行断言\n>       assert judge.verify(expected, actual, assert_type=assert_type, use_ai_assertion=use_ai)\nE       assert False\nE        +  where False = verify('成功，返回新用户信息。', '{\"timestamp\":\"2026-02-04T02:39:22.211+00:00\",\"status\":500,\"error\":\"Internal Server Error\",\"path\":\"/api/user/add\"}', assert_type='semantic_match', use_ai_assertion=False)\nE        +    where verify = <src.core.ai_judge.AIJudge object at 0x7bd07a1933a0>.verify\n\ntest_runner/test_executor.py:70: AssertionError","steps":[],"attachments":[{"uid":"4ad7980a5b649cf8","name":"log","source":"4ad7980a5b649cf8.txt","type":"text/plain","size":119},{"uid":"1ce1efb1d4b6e0a3","name":"stderr","source":"1ce1efb1d4b6e0a3.txt","type":"text/plain","size":117}],"parameters":[],"shouldDisplayMessage":true,"stepsCount":0,"attachmentsCount":2,"hasContent":true,"attachmentStep":false},"afterStages":[],"labels":[{"name":"feature","value":"用户管理"},{"name":"story","value":"创建用户"},{"name":"parentSuite","value":"test_runner"},{"name":"suite","value":"test_executor"},{"name":"host","value":"user"},{"name":"thread","value":"476075-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"test_runner.test_executor"},{"name":"resultFormat","value":"allure2"}],"parameters":[{"name":"case_data","value":"{'title': '创建新用户成功', 'module': '用户管理', 'story': '创建用户', 'name': '创建新用户成功', 'url': 'http://localhost:1234/api/user/add', 'method': 'POST', 'headers': {'Authorization': 'Bearer {token}'}, 'params': {}, 'data': {'username': 'new_user', 'password': '123456', 'email': 'new_user@example.com', 'role': 'USER'}, 'expected': '成功，返回新用户信息。', 'assert_type': 'semantic_match', 'use_ai_assertion': False}"}],"links":[],"hidden":false,"retry":false,"extra":{"severity":"normal","retries":[{"uid":"3a833f05806c024f","status":"failed","statusDetails":"AssertionError: assert False\n +  where False = verify('成功，返回新用户信息。', '{\"timestamp\":\"2026-02-04T02:37:15.560+00:00\",\"status\":500,\"error\":\"Internal Server Error\",\"path\":\"/api/user/add\"}', assert_type='semantic_match', use_ai_assertion=False)\n +    where verify = <src.core.ai_judge.AIJudge object at 0x71275ac23ac0>.verify","time":{"start":1770172635505,"stop":1770172635577,"duration":72}},{"uid":"81d66bd8f579e46b","status":"failed","statusDetails":"AssertionError: assert False\n +  where False = verify('成功，返回新用户信息。', '{\"timestamp\":\"2026-02-04T02:33:21.032+00:00\",\"status\":500,\"error\":\"Internal Server Error\",\"path\":\"/api/user/add\"}', assert_type='semantic_match', use_ai_assertion=False)\n +    where verify = <src.core.ai_judge.AIJudge object at 0x742b20256b90>.verify","time":{"start":1770172400977,"stop":1770172401049,"duration":72}},{"uid":"4ecde02b84713ef9","status":"failed","statusDetails":"AssertionError: assert False\n +  where False = verify('成功，返回新用户信息。', '{\"timestamp\":\"2026-02-04T02:33:03.245+00:00\",\"status\":500,\"error\":\"Internal Server Error\",\"path\":\"/api/user/add\"}', assert_type='semantic_match', use_ai_assertion=False)\n +    where verify = <src.core.ai_judge.AIJudge object at 0x7418770c3ca0>.verify","time":{"start":1770172383179,"stop":1770172383262,"duration":83}},{"uid":"9f903ffc8e028bb0","status":"failed","statusDetails":"AssertionError: assert False\n +  where False = verify('成功，返回新用户信息。', '{\"timestamp\":\"2026-02-04T02:31:48.411+00:00\",\"status\":500,\"error\":\"Internal Server Error\",\"path\":\"/api/user/add\"}', assert_type='semantic_match', use_ai_assertion=False)\n +    where verify = <src.core.ai_judge.AIJudge object at 0x7c314955b130>.verify","time":{"start":1770172308303,"stop":1770172308430,"duration":127}}],"categories":[{"name":"Product defects","matchedStatuses":[],"flaky":false}],"tags":[]},"source":"3fd6ebb6055a5cf.json","parameterValues":["{'title': '创建新用户成功', 'module': '用户管理', 'story': '创建用户', 'name': '创建新用户成功', 'url': 'http://localhost:1234/api/user/add', 'method': 'POST', 'headers': {'Authorization': 'Bearer {token}'}, 'params': {}, 'data': {'username': 'new_user', 'password': '123456', 'email': 'new_user@example.com', 'role': 'USER'}, 'expected': '成功，返回新用户信息。', 'assert_type': 'semantic_match', 'use_ai_assertion': False}"]}