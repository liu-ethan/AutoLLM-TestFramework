# AutoLLM-TestFramework

**åŸºäº RAG åˆ‡ç‰‡ä¸ Agent ååŒçš„å¤§æ¨¡å‹æ™ºèƒ½æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶**

æœ¬é¡¹ç›®ä»¥ **RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰** ä¸ºåˆ‡ç‰‡å…¥å£ï¼Œä»¥ **Agentic Workflowï¼ˆä»£ç†å·¥ä½œæµï¼‰** ä¸ºç”Ÿæˆä¸è¯„å®¡é—­ç¯ï¼Œå½¢æˆâ€œæ–‡æ¡£åˆ‡ç‰‡ â†’ ç”¨ä¾‹ç”Ÿæˆ â†’ è¯„å®¡è¿­ä»£ â†’ ç”¨ä¾‹æ‰§è¡Œâ€çš„å®Œæ•´é“¾è·¯ã€‚

## æ ¸å¿ƒèƒ½åŠ›

* **RAG æ–‡æ¡£åˆ‡ç‰‡**: åŸºäº Markdown æ ‡é¢˜è¿›è¡Œè¯­ä¹‰åˆ‡ç‰‡ï¼Œå¹¶æ”¯æŒé•¿åº¦ä¸å…³é”®è¯è¿‡æ»¤éæ­£æ–‡å—ã€‚
* **Agentic è´¨é‡å®ˆé—¨**: ç”Ÿæˆ Agent ç¼–å†™ç”¨ä¾‹ï¼Œè¯„åˆ¤ Agent è¿›è¡Œé€»è¾‘æ ¡éªŒï¼Œå¾ªç¯è¿­ä»£ç›´è‡³é€šè¿‡æˆ–è¾¾åˆ°ä¸Šé™ã€‚
* **å¤šæ¨¡å‹è·¯ç”±**: æ”¯æŒæŒ‰æ¨¡å—æŒ‡å®šä¸åŒæ¨¡å‹æ¡£ä½ï¼ˆç”Ÿæˆ/è¯„åˆ¤/æ–­è¨€å¯åˆ†å¼€ï¼‰ã€‚
* **å…¨å±€ä¸Šä¸‹æ–‡ç®¡ç†**: é€šè¿‡å…¨å±€å˜é‡æ³¨å…¥è´¦å·ã€é€šç”¨è¯·æ±‚å¤´ã€ç¯å¢ƒåœ°å€ç­‰ä¿¡æ¯ã€‚
* **Token è‡ªåŠ¨é‰´æƒ**: æµ‹è¯•æ‰§è¡Œé˜¶æ®µå¯è‡ªåŠ¨è·å–å¹¶æ³¨å…¥ Tokenã€‚
* **é…ç½®è§£è€¦**: ç»Ÿä¸€ç”± `config/settings.yaml` ç®¡ç†ç­–ç•¥é…ç½®ã€‚

## ç›®å½•ç»“æ„

```text
AutoLLM-TestFramework
â”œâ”€â”€ config
â”‚   â”œâ”€â”€ prompt_templates.yaml   # [Prompt] ç”Ÿæˆä¸è¯„åˆ¤çš„åŒé‡æç¤ºè¯
â”‚   â”œâ”€â”€ settings.yaml           # [Config] RAG è§„åˆ™ã€Agent é˜ˆå€¼ã€Token é…ç½®
â”‚   â””â”€â”€ global_vars.yaml        # [Data] å…¨å±€å˜é‡æ± ï¼ˆè´¦å·ã€å¯†ç ã€é€šç”¨å¤´ä¿¡æ¯ï¼‰
â”œâ”€â”€ data
â”‚   â”œâ”€â”€ raw_docs                # [Docs] åŸå§‹æ¥å£æ–‡æ¡£ (Markdown)
â”‚   â””â”€â”€ test_cases              # [Cases] æŒ‰æ¨¡å—ç”Ÿæˆçš„å¤šä¸ª JSON ç”¨ä¾‹æ–‡ä»¶
â”œâ”€â”€ logs
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ agent_core              # [Core] Agent æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ generator.py        # ç”Ÿæˆ Agent (Student)
â”‚   â”‚   â”œâ”€â”€ judge.py            # è¯„åˆ¤ Agent (Teacher)
â”‚   â”‚   â””â”€â”€ orchestration.py    # ç¼–æ’å¾ªç¯æ§åˆ¶é€»è¾‘
â”‚   â”œâ”€â”€ rag_core                # [Core] RAG é¢„å¤„ç†
â”‚   â”‚   â””â”€â”€ doc_slicer.py       # åŸºäº LangChain çš„æ–‡æ¡£åˆ‡ç‰‡å™¨
â”‚   â”œâ”€â”€ llm_client
â”‚   â””â”€â”€ utils
â”œâ”€â”€ test_runner
â”‚   â”œâ”€â”€ conftest.py             # [Run] å°è£… Token Fixture ä¸ å…¨å±€ Setup
â”‚   â””â”€â”€ test_executor.py        # [Run] åŠ¨æ€åŠ è½½æ‰€æœ‰ JSON ç”¨ä¾‹
â”œâ”€â”€ run.py
â””â”€â”€ requirements.txt

```

### é¡¹ç›®æ¶æ„

```text
                                     +---------------------------+
                                     |
                                     | CLI å…¥å£: run.py           |
                                     +-------------+-------------+
                                                   |
                                     +-------------+-------------+
                                     |                           |
                            [ ç”Ÿæˆæ¨¡å¼ (Gen) ]              [ æ‰§è¡Œæ¨¡å¼ (Run) ]
                                     |                           |
                                     V                           V
+---------------------+    +-------------------+       +-----------------------+
|  config/global_vars | -> |   RAG Processor   |       | pytest (test_runner)  |
|  (è´¦å·/å¯†ç /Host)    |    | (æ ‡é¢˜åˆ‡ç‰‡)        |       +-----------+-----------+
+---------------------+    +---------+---------+                   |
                                     |                             |
                          +----------+----------+         +--------+--------+
                          |      Doc Chunks     |         | conftest.py     |
                          | (å¸¦å…¨å±€å˜é‡Context)  |         | (Token å°è£…/é‰´æƒ)|
                          +----------+----------+         +--------+--------+
                                     |                             |
                                     V                             |
                    +--------------------------------+             |
                    |    Agentic Loop (ç”Ÿæˆ+è¯„å®¡)     |             |
                    |                                |             |
                    |  +-----------+   +----------+  |             |
+--------------+    |  | Generator |-->|  Judge   |  |             |
| prompt_templs| -> |  |  (Agent)  |   |  (Agent) |  |             |
+--------------+    |  +-----+-----+   +-----+----+  |             |
                    |        ^               |       |             |
                    |        |    (Retry)    |       |             |
                    |        +-------<-------+       |             |
                    |             (Pass)             |             |
                    +----------------+---------------+             |
                                     |                             |
                                     V                             V
                          +----------+----------+         +--------+--------+
                          |   data/test_cases   | <-----> |  test_executor  |
                          | (module_A/B.json)   |         | (æ‰¹é‡åŠ è½½ & å‚æ•°åŒ–)|
                          +---------------------+         +--------+--------+
                                                                   |
                                                          +--------+--------+
                                                          |    SUT (System) |
                                                          |  (æºå¸¦ Token è¯·æ±‚)|
                                                          +--------+--------+
                                                                   |
                                                          +--------+--------+
                                                          |  Allure Report  |
                                                          +-----------------+

```

---

### ğŸ’¡ æ ¸å¿ƒé“¾è·¯è§£è¯»

1. **RAG é¢„å¤„ç†é“¾è·¯**ï¼š
* è¯»å– `data/raw_docs` ä¸‹çš„ Markdown æ–‡æ¡£ã€‚
* æŒ‰æ ‡é¢˜å±‚çº§åˆ‡åˆ†æ–‡æ¡£ï¼Œå¹¶è¿‡æ»¤éæ­£æ–‡æ¨¡å—ã€‚
* åŒæ—¶è¯»å– `config/global_vars.yaml`ï¼Œå°†å…¨å±€å˜é‡ï¼ˆå¦‚æµ‹è¯•è´¦å·ï¼‰æ³¨å…¥åˆ°æ¯ä¸ªåˆ‡ç‰‡çš„ Context ä¸­ã€‚


2. **Agentic ç”Ÿæˆé“¾è·¯**ï¼š
* **Generator**ï¼šåŸºäºåˆ‡ç‰‡å†…å®¹å’Œ Prompt ç”Ÿæˆåˆå§‹ JSON ç”¨ä¾‹ã€‚
* **Judge**ï¼šå¯¹ç”Ÿæˆçš„ JSON è¿›è¡Œé€»è¾‘æ ¡éªŒï¼ˆæ£€æŸ¥å­—æ®µå®Œæ•´æ€§ã€æ–­è¨€åˆç†æ€§ï¼‰ã€‚å¦‚æœä¸é€šè¿‡ï¼ŒJudge ä¼šç»™å‡ºåé¦ˆæ„è§ï¼ŒGenerator è¿›è¡Œè‡ªæˆ‘ä¿®æ­£ï¼ˆRetryï¼‰ï¼Œç›´åˆ° Judge åˆ¤å®š "Pass"ã€‚
* æœ€ç»ˆç”Ÿæˆå¤šä¸ª JSON æ–‡ä»¶ï¼ˆå¦‚ `user.json`, `order.json`ï¼‰å­˜å…¥ `data/test_cases`ã€‚

2.1 **å¤šæ¨¡å‹é…ç½®**ï¼š
* `llm_profiles` å®šä¹‰ä¸åŒæ¨¡å‹æ¡£ä½ï¼ˆsmall/largeï¼‰ã€‚
* `llm_modules` ç»‘å®šæ¨¡å—ä¸æ¨¡å‹æ¡£ä½ï¼Œä¾‹å¦‚ç”Ÿæˆç”¨å°æ¨¡å‹ã€è¯„åˆ¤ç”¨å¤§æ¨¡å‹ã€‚


3. **Token å°è£…ä¸æ‰§è¡Œé“¾è·¯**ï¼š
* `pytest` å¯åŠ¨æ—¶ï¼Œ`conftest.py` ä¸­çš„ `session` çº§åˆ« Fixture ä¼šè‡ªåŠ¨è°ƒç”¨ç™»å½•æ¥å£è·å– Tokenã€‚
* Token è¢«æ³¨å…¥åˆ°å…¨å±€è¯·æ±‚ Session æˆ– Headers ä¸­ã€‚
* `test_executor.py` éå† `data/test_cases` ç›®å½•ï¼ŒåŠ è½½æ‰€æœ‰ JSON æ–‡ä»¶ï¼Œé©±åŠ¨æ•°æ®åŒ–æµ‹è¯•ã€‚


4. **é…ç½®è§£è€¦**ï¼š
* æ‰€æœ‰çš„å˜é‡ï¼ˆURLã€è´¦å·ã€Promptã€åˆ‡ç‰‡è§„åˆ™ï¼‰å‡ä¸å†™æ­»åœ¨ä»£ç ä¸­ï¼Œç»Ÿä¸€åœ¨ `config/settings.yaml` å’Œ `config/global_vars.yaml` ä¸­ç®¡ç†ã€‚

---

## å¿«é€Ÿå¯åŠ¨

### 1) ç¯å¢ƒå‡†å¤‡

- Python 3.10+
- å·²é…ç½®å¯è®¿é—®çš„æ¨¡å‹æœåŠ¡
- å¯é€‰ï¼šå¦‚éœ€ä½¿ç”¨ LangChain åˆ‡ç‰‡å™¨ï¼Œé¢å¤–å®‰è£… langchain

### 2) å®‰è£…ä¾èµ–

åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œï¼š

pip install -r requirements.txt

å¦‚éœ€ä½¿ç”¨ LangChain åˆ‡ç‰‡å™¨ï¼š

pip install langchain

### 3) é…ç½®

- ç¼–è¾‘ `config/settings.yaml` é…ç½®æ¨¡å‹ä¸æ‰§è¡Œå‚æ•°
- ç¼–è¾‘ `config/prompt_templates.yaml` è°ƒæ•´æç¤ºè¯
- ç¼–è¾‘ `config/global_vars.yaml` å¡«å……å…¨å±€å˜é‡

### 4) å‡†å¤‡æ¥å£æ–‡æ¡£

å°†æ¥å£è¯´æ˜æ–‡æ¡£æ”¾å…¥ `data/raw_docs`

### 5) ç”Ÿæˆç”¨ä¾‹

python run.py --mode generate

æˆ–æŒ‡å®šå•ä¸ªæ–‡æ¡£ï¼š

python run.py --mode generate --doc data/raw_docs/your_doc.md

### 6) æ‰§è¡Œæµ‹è¯•

python run.py --mode run

å¦‚éœ€è‡ªåŠ¨è·å– Tokenï¼š

- åœ¨ `config/settings.yaml` å¡«å†™ auth é…ç½®
- å°† `execution.auto_inject_token` è®¾ä¸º true

### 7) ä¸€é”®ç”Ÿæˆä¸æ‰§è¡Œ

python run.py --mode all

å¦‚éœ€æŠ¥å‘Šï¼Œè¯·å…ˆå®‰è£…æŠ¥å‘Šå·¥å…·å‘½ä»¤è¡Œï¼Œéšåä½¿ç”¨ï¼š

allure generate allure-results -o allure-report --clean

allure serve allure-results