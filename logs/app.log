2026-02-17 18:33:14,855 | INFO | __main__ | Generating test cases...
2026-02-17 18:33:14,940 | INFO | src.core.case_generator | Skipping non-interface chunk: 农产品销售系统 API 接口文档 v1.0
2026-02-17 18:33:14,940 | INFO | src.core.case_generator | Skipping non-interface chunk: 3. 接口列表
2026-02-17 18:33:14,940 | INFO | src.agent_core.orchestration | Agentic round 1/2
2026-02-17 18:33:48,036 | INFO | src.agent_core.orchestration | Agentic round 2/2
2026-02-17 18:34:29,602 | INFO | src.core.case_generator | Agent judge feedback: Fail

修改建议（字段完整性/断言合理性/覆盖性）：

1. **异常用例的 HTTP 状态码不应拍脑袋**
   - 文档只给了成功 200 示例，未声明 401/405/415/422/400 等错误码。  
   - 建议：对“缺参/鉴权失败/方法不允许/不支持的媒体类型/非法JSON”等用例，把 `expected_status` 改为**可配置或放宽**（例如断言 `status != 200`），或根据实际实现补充接口错误码规范后再固定。

2. **异常用例断言过弱**
   - 目前基本只有 `code != '0'`，无法保证返回结构正确、错误信息合理。
   - 建议增加通用断言（在不确定具体错误码时也可做结构校验）：
     - `code exists`
     - `msg exists`
     - `data` 可能为 `null/{}`
     - 可选：`msg` 包含关键字（如“username”“password”“Content-Type”“method”），需与实际返回对齐后再落地。

3. **成功用例断言与文档示例不一致/不够严谨**
   - 示例返回 `data.username: "admin"`，而请求用户名是 `test_usr123`，说明示例只是示意。你当前只断言 `data.username exists`，但没有约束类型。
   - 建议成功断言至少补齐类型校验：
     - `typeof data.username === 'string'`
     - `typeof data.role === 'string'`
     - `data.id` 为 number（你已做）
   - 若实际期望返回当前登录用户信息，再补充断言 `data.username == 请求username`（需要与真实实现确认）。

4. **“非法 JSON 体”用例不严谨**
   - `Content-Type: application/json` + body 给字符串 `username=...` 在很多客户端仍会作为“合法字符串JSON失败/或被当作原始文本”处理，依赖实现。
   - 建议明确构造：发送**无法解析的 JSON 原文**（例如 `"{bad json"`），并确保请求发送的是 raw body，而不是被框架自动序列化。

5. **覆盖面仍缺少关键异常输入**
   - 建议补充：
     - 空字符串：`username: ""` / `password: ""`
     - 类型错误：`username: 123` / `password: true`
     - 超长边界：用户名/密码超长（如 256/1024），验证是否 4xx 且有合理 msg
     - 可选：缺少 body（空请求体）

把以上问题修正后再评为通过。
2026-02-17 18:34:29,604 | INFO | src.core.case_generator | Generated cases saved to data/test_cases/3_1_User_Login_cases.json
2026-02-17 18:34:29,604 | INFO | src.agent_core.orchestration | Agentic round 1/2
2026-02-17 18:35:03,873 | INFO | src.agent_core.orchestration | Agentic round 2/2
2026-02-17 18:35:30,699 | INFO | src.core.case_generator | Agent judge feedback: Fail

修改建议：
1. **断言过于具体且不可靠**：多条“成功”用例把 `records: []`、`total: 0` 写死；实际环境数据不确定。应改为断言结构与字段类型/范围：`code=="0"`，`data.records` 为数组，`data.total>=0`，`data.size==请求size或默认10`，`data.current==请求currentPage或默认1`。
2. **分页字段命名需核对**：请求参数是 `currentPage`，响应示例返回 `current`。用例里既传 `currentPage` 又断言 `current`，可以，但需增加断言“响应 current 与请求 currentPage 一致”；同时补充测试传 `current` 是否无效（避免混用导致误用）。
3. **异常场景断言不符合文档**：文档只给出成功示例，未说明错误码/错误字段。用例里假设 `code:"400", message:"参数错误"` 依据不足。建议改为更通用断言：HTTP 状态为 4xx 或 `code!="0"` 且包含错误信息字段（按实际接口规范补齐）。
4. **缺少认证异常覆盖**：接口标注“认证：是”，但未测试缺失/无效 token（401/403）。需新增：
   - 不带 Authorization
   - 带过期/无效 token
5. **缺少关键参数边界/类型异常**：应补充：
   - `currentPage`/`size` 传字符串、浮点、超大值
   - `size=0`、`currentPage=1` 边界
6. **过滤条件覆盖不全**：未覆盖 `name/status`，也未覆盖多条件组合（username+role+status）。
7. **“SQL注入查询”用例期望不合理**：你期望 `code:"0"` 且空结果是拍脑袋。更合理是：请求应被安全处理（不报 500），返回正常分页结构；可断言“不出现服务端异常/不返回全部数据”，但不能写死为空。
2026-02-17 18:35:30,700 | INFO | src.core.case_generator | Generated cases saved to data/test_cases/3_2_Get_Users_By_Page_cases.json
2026-02-17 18:35:30,700 | INFO | src.agent_core.orchestration | Agentic round 1/2
2026-02-17 18:35:57,530 | INFO | src.agent_core.orchestration | Agentic round 2/2
2026-02-17 18:36:33,663 | INFO | src.core.case_generator | Agent judge feedback: Fail

修改建议（字段完整性/断言合理性/覆盖面）：

1) **断言与文档不一致**
- 文档仅给出失败业务异常示例：`{"code":"-1","msg":"用户名已存在"/"邮箱已存在！"}`，未说明 HTTP 状态码为 400/401/403，也未说明“用户名不能为空/邮箱格式不正确/权限不足”等 msg。
  - 建议：对“用户名已存在/邮箱已存在”用例，**断言 code=-1 且 msg 在枚举值内**即可；HTTP 状态码建议放宽为 `200 或 4xx`（以实际实现为准），不要强绑 400。
  - 对“缺少字段/邮箱格式非法/权限不足”这类**文档未定义**的错误提示，断言应更泛化（如：`code != "0"` 或 `code == "-1"`，msg 只做非空/包含关键字），或先补齐接口错误码规范再精确断言。

2) **认证用例断言不稳**
- 文档只写“认证：是”，未给出未认证时返回 401/响应体结构。
  - 建议：断言 `status_code in (401,403)` 或断言返回体存在 `code/msg`（若系统统一返回），避免仅断言 401。

3) **正向用例断言过少**
- “成功创建新用户”只断言 `code='0'`，未校验返回的关键字段（如 userId/username）或至少 msg。
  - 建议：增加断言返回体包含创建结果字段（若有），或至少 `msg`/`data` 非空；并可增加后置校验（可选）：再查用户/重复创建触发“已存在”。

4) **覆盖面仍有缺口**
- 缺少：Content-Type 非 JSON/缺失、body 非法 JSON、字段类型错误（username 非 string）、空字符串/超长边界、password 强度/长度边界、role 非法枚举值（而不是“admin 权限不足”这种与“创建用户入参role”语义混淆的用例）。
  - 建议：补充上述异常与边界用例；“角色权限不足”应改为“**当前调用者权限不足（非 role=admin）**”，即使用普通 token 调用并断言无权限（若系统有该规则），否则删除该用例。
2026-02-17 18:36:33,665 | INFO | src.core.case_generator | Generated cases saved to data/test_cases/3_3_Create_User_cases.json
2026-02-17 18:36:33,665 | INFO | src.agent_core.orchestration | Agentic round 1/2
2026-02-17 18:36:51,257 | INFO | src.agent_core.orchestration | Agentic round 2/2
2026-02-17 18:37:30,023 | INFO | src.core.case_generator | Agent judge feedback: Fail

修改建议（字段完整性、断言合理性、覆盖性）：

1) **204 响应断言不合理**
- 用例1期望 `expected_status: 204` 但还断言 `message: 'Password updated successfully'`。204 通常**无响应体**，不应断言 message。
- 建议：要么把期望状态改为 200 并断言 body message；要么保持 204，仅断言无 body/Content-Length、并通过后续登录/再次调用验证生效。

2) **错误码假设过多，可能不符合规范**
- 用例4（旧密码错误）期望 401；也可能是 400/403，文档未规定。
- 用例6（token expired）期望 403；很多系统是 401。
- 用例9（path 非整型）期望 400；不少框架会返回 404。
- 建议：若无明确约定，断言应更通用：只断言 4xx 范围 + 错误码/错误字段（如 `code`）而不是固定文案；或补充接口错误码规范后再精确断言。

3) **异常场景缺关键覆盖**
- 缺少：**未携带 Authorization**（应 401/403）。
- 缺少：**缺少必填字段**（body 不包含 `oldPassword` 或不包含 `newPassword`），当前只有 `newPassword: None`、`oldPassword: ''`，但“字段缺失”和“空值”是两类校验。
- 缺少：**Content-Type 非 application/json / body 非法 JSON**（常见 415/400）。
- 建议补用例：headers 缺失/错误、body 字段缺失、非法 JSON。

4) **部分业务规则未在文档中出现，不宜强断言**
- 用例7 “新旧密码不能相同” 文档未提到；可作为扩展校验，但不应强绑定固定 message/400，除非产品有明确规则。
- 建议：标注为“如果系统有该规则则期望…”，或仅断言 4xx + 错误字段。

5) **路径参数边界用例可保留，但需与实现对齐**
- id=0、-1、string_id 这些边界很好，但状态码/返回体断言应与路由/校验方式对齐（可能 404/422 等）。
- 建议：把断言从固定 `400 + 'Invalid user ID'` 调整为更贴近框架实际（例如 404/422）或使用可配置期望。

6) **环境变量未利用/一致性**
- 全局变量提供 `account.username/password`，但用例中没有体现“用旧密码登录失败/新密码成功”的具体调用步骤与断言方法，仅写了布尔值。
- 建议：把断言落到可执行步骤：更新后调用登录接口或鉴权接口验证旧密码失败、新密码成功；并在用例后做数据回滚/重置密码，避免用例互相污染。
2026-02-17 18:37:30,024 | INFO | src.core.case_generator | Generated cases saved to data/test_cases/3_4_Update_Password_cases.json
2026-02-17 18:37:30,024 | INFO | src.agent_core.orchestration | Agentic round 1/2
2026-02-17 18:37:52,038 | INFO | src.agent_core.orchestration | Agentic round 2/2
2026-02-17 18:38:20,959 | INFO | src.core.case_generator | Agent judge feedback: Fail

修改建议：
1) **用例重复**：第1/4/5条完全一致，去重，保留1条正向即可。  
2) **方法与参数位置不一致**：接口定义为 **GET + Query**，最后一条用 **POST** 还把参数放在 `query`，建议：  
   - 负向“方法不允许”用例保留，但明确断言 **405**（或按规范的 4xx），并可不带 query；或改为 `body` 以体现错误用法。  
3) **断言不够合理/不够具体**：  
   - `status_code: '2xx'/'4xx'` 过泛，建议明确常见码（如成功 200，参数错误 400，方法不允许 405）。  
   - `response.contains: ['success','message']` 可能只是字符串包含，且不保证字段存在。建议断言关键字段存在/类型正确（如 `code==0`、`message` 非空、`success==true` 或 `error` 字段等，按实际返回结构）。  
4) **异常场景覆盖不全**（接口必填参数）：补充至少以下用例：  
   - 缺失 `email`（不传）→ 4xx  
   - 缺失 `newPassword` → 4xx  
   - `email` 为空字符串/仅空格 → 4xx  
   - `newPassword` 为空/仅空格 → 4xx  
   - 未注册邮箱（业务错误）→ 4xx（并断言错误码/错误信息）  
5) **“short 密码”假设缺少依据**：文档未给密码规则，若要测密码强度/长度，请在断言中以实际接口规则为准；否则改为更通用的非法值（空、null、超长、包含非法字符等）。
2026-02-17 18:38:20,960 | INFO | src.core.case_generator | Generated cases saved to data/test_cases/3_5_Forget_Password_cases.json
2026-02-17 18:38:20,960 | INFO | src.agent_core.orchestration | Agentic round 1/2
2026-02-17 18:38:47,931 | INFO | src.agent_core.orchestration | Agentic round 2/2
2026-02-17 18:39:26,085 | INFO | src.core.case_generator | Agent judge feedback: Fail

修改建议（字段与断言）：
1. **断言缺少业务错误覆盖**：文档明确删除业务错误 `code=-1/-2`，用例未覆盖。补充：
   - 单个删除：用户关联商家触发 `code=-1,msg=删除失败,请检查关联商家`
   - 单个删除：用户关联库存触发 `code=-2,msg=删除失败，请检查关联库存`
   - 批量删除同理（至少各 1 条）
2. **成功用例断言不够合理/完整**：仅校验“结构 code/msg”，未校验**code 的期望值**（如成功时 code 是否为 0/1 未定义但至少应约束为“成功码”），也未校验 msg/数据字段。建议：
   - 明确成功时 `code` 的期望范围/具体值（若未知，至少断言 `code != -1 && code != -2` 且 msg 表示成功）
3. **404/400/401 的假设未与文档对齐**：文档未定义这些 HTTP 状态码行为。建议改为：
   - 若系统统一 200 + 业务 code：则这些用例应断言 `status_code=200` 且 `code` 为相应参数错误/未授权业务码（需补充从接口规范获取）。
   - 若确实走 HTTP 状态码：需在文档/接口约定中补充依据，否则断言不稳。
4. **“ID缺失”用例 URL 不合法**：`/delete/` 很可能路由不到（可能 404 而非 400）。建议改为：
   - 用例删除该条或改为“id 为非数字/空字符串”等更可控场景（如 `/delete/abc`）。
5. **批量重复 ID 必然 400 的断言不可靠**：很多实现会去重后删除并返回成功。建议：
   - 要么断言为“成功且实际只删除一次/返回去重后的处理结果”（若有返回数据）
   - 要么从规范确认重复 ID 的预期，再写断言
6. **鉴权用例信息不完整**：文档给了账号全局变量，但用例未体现登录/Token/鉴权头字段；仅清空 headers 不一定等价未授权。建议：
   - 增加前置：登录获取 token；正常用例带 `Authorization`
   - 未授权用例明确缺少/错误 token 的断言（状态码或业务码）
7. **参数放置不一致**：批量删除把 `ids` 写在 url 上但 `params` 为空。建议统一：`url=/deleteBatch` + `params:{ids:'1,2,3'}`（或保持 url 但去掉 params 字段）。

补齐以上后再评估是否 Pass。
2026-02-17 18:39:26,086 | INFO | src.core.case_generator | Generated cases saved to data/test_cases/3_6_Delete_cases.json
2026-02-17 18:39:26,087 | INFO | src.agent_core.orchestration | Agentic round 1/2
2026-02-17 18:39:49,110 | INFO | src.agent_core.orchestration | Agentic round 2/2
2026-02-17 18:40:26,529 | INFO | src.core.case_generator | Agent judge feedback: Fail

修改建议（字段完整性/断言合理性/覆盖面）：

1. **缺少请求头字段**
   - 文档提供了 `headers: Content-Type: application/json`，用例里未体现。建议每条用例补充 `headers: {{headers}}`（即使 GET 也保持一致性）。

2. **正向用例断言不够严谨，且与数据前置不一致**
   - `GET {{base_url}}/1` 断言 `username == {{account.username}}` 不一定成立（除非明确 id=1 就是该账号）。  
     建议：
     - 要么增加前置：先创建用户并拿到 `id` 再查详情；
     - 要么放宽断言：仅校验字段存在与类型（id/username/role），不强绑定 `username`。
   - `/role/admin` 返回应为“列表”，你只断言了数组里一个元素的结构，但未断言“全部元素 role 都为 admin”。  
     建议补充：遍历断言每个元素 `role == 'admin'`，并断言数组类型、可为空/不为空的预期（需明确）。

3. **异常场景的状态码假设可能不合理，需要与接口约定对齐**
   - `/role/nonexistent_role` 你期望 404，但“按角色查询用户列表”更常见的行为是 **200 返回空数组**。  
     建议：改为期望 `200` + `body: []`，除非文档/实现明确规定无此角色返回 404。
   - `/username/`、`/role/` 这类“缺少 path 参数”的请求很多框架会直接 **404（路由不匹配）**，不一定是 400。  
     建议：要么改为 404，要么改测更确定的非法参数（如 username 含非法字符、role 为空格/超长等）并期望 400。

4. **“获取全部 /” 用例断言不充分**
   - 建议至少断言：返回为数组；数组元素包含 `id/username/role`；可选补充：元素数量>=0；字段类型校验一致。

5. **缺少关键边界/异常覆盖**
   - 建议补充：
     - `id=0`、负数、超大数（你有超大数但可再加 0/负数）
     - username 大小写敏感性（若要求精确查询）、特殊字符/URL 编码（如空格、中文、%xx）
     - role 大小写/非法值（如数字、特殊字符）、超长字符串

按以上调整后再评审。
2026-02-17 18:40:26,530 | INFO | src.core.case_generator | Generated cases saved to data/test_cases/3_7_Basic_Queries_cases.json
